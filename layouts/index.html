{{ define "main" }}
{{ $author := site.GetPage "authors/admin" }}
{{ $avatar := $author.Resources.GetMatch "avatar*" }}
{{ $pubs := site.Data.selected_publications }}
{{ $proExp := site.Data.professional_experience }}

<main class="zsq-page">
  <aside class="zsq-sidebar">
    {{ with $avatar }}
      <img class="zsq-avatar" src="{{ .RelPermalink }}" alt="{{ $author.Title }}">
    {{ end }}
    <h1 class="zsq-name">{{ $author.Title }}</h1>
    {{ with $author.Params.role }}
      <div class="zsq-role">{{ . }}</div>
    {{ end }}
    {{ with $author.Params.organizations }}
      <ul class="zsq-orgs">
        {{ range . }}
          <li>
            {{ if .url }}
              <a href="{{ .url }}" rel="noopener">{{ .name }}</a>
            {{ else }}
              {{ .name }}
            {{ end }}
          </li>
        {{ end }}
      </ul>
    {{ end }}
    {{ with $author.Params.email }}
      <div class="zsq-email">{{ . }}</div>
    {{ end }}
    {{ with $author.Params.social }}
      <div class="zsq-socials">
        {{ range . }}
          <a class="zsq-social" href="{{ .link }}" rel="noopener">
            {{ if eq .icon_pack "ai" }}
              <i class="ai ai-{{ .icon }}"></i>
            {{ else }}
              <i class="{{ .icon_pack }} fa-{{ .icon }}"></i>
            {{ end }}
          </a>
        {{ end }}
      </div>
    {{ end }}
  </aside>

  <div class="zsq-main">
    <nav class="zsq-nav">
      <a href="#about">Home</a>
      <a href="#experience">Experience</a>
      <a href="#publications">Publications</a>
    </nav>

    <section id="about" class="zsq-section">
      <h2>Biography</h2>
      <div class="zsq-text">
        {{ $author.Content }}
      </div>
    </section>

    {{ with $proExp }}
      <section id="experience" class="zsq-section">
        <h2>Professional Experience</h2>
        <div class="zsq-exp">
          {{ range . }}
            <div class="zsq-exp-item">
              <div class="zsq-exp-logo">
                {{ if .logo }}
                  <img src="{{ .logo }}" alt="{{ .company }}">
                {{ else }}
                  <div class="zsq-logo-placeholder">Logo</div>
                {{ end }}
              </div>
              <div class="zsq-exp-body">
                <div class="zsq-item-title">{{ .title }}</div>
                <div class="zsq-item-meta">{{ .company }}{{ with .location }}, {{ . }}{{ end }}</div>
                <div class="zsq-item-year">
                  {{ with .date_start }}{{ time . | time.Format "Jan 2006" }}{{ end }}
                  {{ if .date_end }}
                    - {{ time .date_end | time.Format "Jan 2006" }}
                  {{ else }}
                    - Present
                  {{ end }}
                </div>
                {{ with .summary }}
                  <div class="zsq-item-summary">{{ . }}</div>
                {{ end }}
              </div>
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    {{ with $author.Params.education.courses }}
      <section id="education" class="zsq-section">
        <h2>Education</h2>
        <ul class="zsq-list zsq-list-tight">
          {{ range . }}
            <li>
              <div class="zsq-item-title">{{ .course }}</div>
              <div class="zsq-item-meta">{{ .institution }}</div>
              {{ with .year }}
                <div class="zsq-item-year">{{ . }}</div>
              {{ end }}
            </li>
          {{ end }}
        </ul>
      </section>
    {{ end }}

    <section id="publications" class="zsq-section">
      <h2>Selected Publications</h2>
      <div class="zsq-filter">
        <span class="zsq-filter-label">Filter:</span>
        <button class="zsq-filter-btn is-active" data-tag="all" type="button">All</button>
        {{ $tags := slice }}
        {{ range $pubs }}
          {{ with .tags }}
            {{ range . }}
              {{ $tags = $tags | append . }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ $tags = uniq $tags | sort }}
        {{ range $tags }}
          <button class="zsq-filter-btn" data-tag="{{ . }}" type="button">{{ . }}</button>
        {{ end }}
      </div>
      <div class="zsq-pubs">
        {{ range $pubs }}
          <div class="zsq-pub" data-tags="{{ with .tags }}{{ delimit . "," }}{{ end }}">
            <div class="zsq-pub-figure">
              {{ if .figure }}
                <img src="{{ .figure }}" alt="{{ .title }}">
              {{ else }}
                <div class="zsq-figure-placeholder">Figure</div>
              {{ end }}
            </div>
            <div class="zsq-pub-body">
              <div class="zsq-pub-title">{{ .title }}</div>
              {{ with .authors }}
                {{ $authors := replace . "Yifu Qiu" "<strong>Yifu Qiu</strong>" }}
                <div class="zsq-pub-authors">{{ $authors | safeHTML }}</div>
              {{ end }}
              {{ with .venue }}
                <div class="zsq-pub-venue">{{ . }}</div>
              {{ end }}
              {{ with .tags }}
                <div class="zsq-pub-tags">
                  {{ range . }}
                    <button class="zsq-tag" data-tag="{{ . }}" type="button">{{ . }}</button>
                  {{ end }}
                </div>
              {{ end }}
              {{ with .links }}
                <div class="zsq-pub-links">
                  {{ with .paper }}<a href="{{ . }}" rel="noopener">paper</a>{{ end }}
                  {{ with .code }}<a href="{{ . }}" rel="noopener">code</a>{{ end }}
                  {{ with .data }}<a href="{{ . }}" rel="noopener">data</a>{{ end }}
                  {{ with .project }}<a href="{{ . }}" rel="noopener">project</a>{{ end }}
                  {{ with .slides }}<a href="{{ . }}" rel="noopener">slides</a>{{ end }}
                  {{ with .video }}<a href="{{ . }}" rel="noopener">video</a>{{ end }}
                </div>
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
      <script>
        (function () {
          var filterButtons = document.querySelectorAll(".zsq-filter-btn");
          var tagButtons = document.querySelectorAll(".zsq-tag");
          var pubs = document.querySelectorAll(".zsq-pub");

          function setActiveTag(tag) {
            filterButtons.forEach(function (btn) {
              btn.classList.toggle("is-active", btn.dataset.tag === tag);
            });
            pubs.forEach(function (pub) {
              var tags = (pub.dataset.tags || "").split(",").filter(Boolean);
              var show = tag === "all" || tags.indexOf(tag) !== -1;
              pub.style.display = show ? "" : "none";
            });
          }

          filterButtons.forEach(function (btn) {
            btn.addEventListener("click", function () {
              setActiveTag(btn.dataset.tag);
            });
          });

          tagButtons.forEach(function (btn) {
            btn.addEventListener("click", function () {
              setActiveTag(btn.dataset.tag);
            });
          });
        })();
      </script>
    </section>
  </div>
</main>
{{ end }}
